apiVersion: v1
kind: ConfigMap
metadata:
  name: sira-config
  labels:
    app: sira-gateway
data:
  # Gateway Configuration
  gateway.yml: |
    port: 8080
    adminPort: 3001
    host: 0.0.0.0
    timeout: 30000
    maxConnections: 1000

    # Security Configuration
    security:
      cors:
        enabled: true
        origins: ["*"]
        methods: ["GET", "POST", "PUT", "DELETE", "PATCH"]
        headers: ["Content-Type", "Authorization", "X-Requested-With"]
      helmet:
        enabled: true
        contentSecurityPolicy:
          directives:
            defaultSrc: ["'self'"]
            scriptSrc: ["'self'", "'unsafe-inline'"]
            styleSrc: ["'self'", "'unsafe-inline'"]
      rateLimit:
        windowMs: 900000  # 15 minutes
        max: 1000
        message: "Too many requests from this IP, please try again later."

    # Monitoring Configuration
    monitoring:
      enabled: true
      interval: 5000
      metrics:
        enabled: true
        path: "/metrics"
      health:
        enabled: true
        path: "/health"
      tracing:
        enabled: true
        serviceName: "sira-gateway"

    # Logging Configuration
    logging:
      level: "info"
      format: "json"
      transports:
        - type: "console"
        - type: "file"
          filename: "/app/logs/gateway.log"
          maxsize: "10m"
          maxFiles: 5

  # AI Routing Configuration
  ai-routing.yml: |
    # AI Model Providers
    providers:
      openai:
        apiKey: "${OPENAI_API_KEY}"
        baseUrl: "https://api.openai.com/v1"
        models:
          - "gpt-3.5-turbo"
          - "gpt-4"
        rateLimit:
          requestsPerMinute: 60
          tokensPerMinute: 40000

      anthropic:
        apiKey: "${ANTHROPIC_API_KEY}"
        baseUrl: "https://api.anthropic.com"
        models:
          - "claude-3-sonnet-20240229"
          - "claude-3-haiku-20240307"
        rateLimit:
          requestsPerMinute: 50
          tokensPerMinute: 25000

      together:
        apiKey: "${TOGETHER_API_KEY}"
        baseUrl: "https://api.together.xyz/v1"
        models:
          - "meta-llama/Llama-2-70b-chat-hf"
          - "mistralai/Mistral-7B-Instruct-v0.1"
        rateLimit:
          requestsPerMinute: 100
          tokensPerMinute: 100000

    # Routing Rules
    routing:
      defaultProvider: "openai"
      fallbackProviders: ["anthropic", "together"]

      # Model mapping
      modelMapping:
        "gpt-3.5-turbo": "openai/gpt-3.5-turbo"
        "gpt-4": "openai/gpt-4"
        "claude-3": "anthropic/claude-3-sonnet-20240229"
        "llama-2-70b": "together/meta-llama/Llama-2-70b-chat-hf"

      # Quality-based routing
      qualityThresholds:
        high: 0.8
        medium: 0.6
        low: 0.4

    # Cost optimization
    costOptimization:
      enabled: true
      maxCostPerRequest: 0.01  # USD
      preferredProviders: ["together", "openai", "anthropic"]

  # Cache Configuration
  cache.yml: |
    # Multi-level caching strategy
    strategy: "multi-level"

    # Redis Cache
    redis:
      enabled: true
      host: redis-service
      port: 6379
      password: "${REDIS_PASSWORD}"
      db: 0
      ttl:
        short: 300    # 5 minutes
        medium: 3600  # 1 hour
        long: 86400   # 24 hours

    # In-memory cache
    memory:
      enabled: true
      maxSize: 100000000  # 100MB
      ttl: 300

    # File-based cache
    file:
      enabled: false
      path: "/app/cache"
      maxSize: 1000000000  # 1GB

    # Cache keys configuration
    keys:
      aiResponse: "ai:response:{hash}"
      modelInfo: "ai:model:{provider}:{model}"
      userQuota: "user:quota:{userId}"
      rateLimit: "ratelimit:{identifier}"

  # Database Configuration
  database.yml: |
    # PostgreSQL Configuration
    postgresql:
      enabled: true
      host: postgres-service
      port: 5432
      database: sira_gateway
      username: "${DB_USERNAME}"
      password: "${DB_PASSWORD}"
      ssl: true
      poolSize: 10
      acquireTimeoutMillis: 60000
      createTimeoutMillis: 30000
      destroyTimeoutMillis: 10000
      idleTimeoutMillis: 900000
      reapIntervalMillis: 1000

    # Redis Configuration (for sessions, queues, etc.)
    redis:
      host: redis-service
      port: 6379
      password: "${REDIS_PASSWORD}"
      db: 1
      keyPrefix: "sira:"

  # Admin Configuration
  admin.yml: |
    # Admin API Configuration
    api:
      enabled: true
      port: 3001
      host: 0.0.0.0
      cors:
        enabled: true
        origins: ["http://localhost:3000", "https://admin.sira-gateway.com"]

    # Authentication
    auth:
      jwt:
        secret: "${JWT_SECRET}"
        expiresIn: "24h"
        refreshExpiresIn: "7d"
      bcryptRounds: 12

      # Default admin user
      defaultUsers:
        admin:
          password: "${ADMIN_PASSWORD}"
          role: "super_admin"

    # Monitoring Dashboard
    dashboard:
      enabled: true
      updateInterval: 5000
      retentionPeriod: 86400000  # 24 hours

      # Alert thresholds
      alerts:
        errorRate: 0.05
        latency: 2000
        cpuUsage: 80
        memoryUsage: 85
---
apiVersion: v1
kind: Secret
metadata:
  name: sira-secrets
  labels:
    app: sira-gateway
type: Opaque
data:
  # Base64 encoded secrets - these should be generated securely
  jwt-secret: 'WW91ciBKV1QgU2VjcmV0IEtleSBIZXJl' # "Your JWT Secret Key Here"
  admin-password: 'QWRtaW5QYXNzdzByZCE=' # "AdminPassw0rd!"
  db-password: 'RGF0YWJhc2VQYXNzdzByZCE=' # "DatabasePassw0rd!"
  redis-password: 'UmVkaXNQYXNzdzByZCE=' # "RedisPassw0rd!"
  openai-api-key: 'T3BlbkFJIEFQSSBLZXkgSGVyZQ==' # "OpenAI API Key Here"
  anthropic-api-key: 'QW50aHJvcGljIEFQSSBLZXkgSGVyZQ==' # "Anthropic API Key Here"
  together-api-key: 'VG9nZXRoZXIgQVBJIEtleSBIZXJl' # "Together API Key Here"
