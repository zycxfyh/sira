# Sira AIç½‘å…³APIé›†æˆæŒ‡å—

## ğŸ“– æ¦‚è¿°

Sira AIç½‘å…³æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„AI APIç½‘å…³ï¼Œæ”¯æŒ20+ä¸»æµAIæœåŠ¡å•†çš„æ™ºèƒ½è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ã€é™æµç­‰ä¼ä¸šçº§åŠŸèƒ½ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»å¦‚ä½•é›†æˆå’Œä½¿ç”¨å„ç§AI APIä¾›åº”å•†ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### ğŸš€ æ™ºèƒ½è·¯ç”±

- **è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ä¾›åº”å•†**: åŸºäºæˆæœ¬ã€æ€§èƒ½ã€å¯ç”¨æ€§æ™ºèƒ½é€‰æ‹©
- **æ•…éšœè‡ªåŠ¨åˆ‡æ¢**: å½“æŸä¸ªä¾›åº”å•†æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨ä¾›åº”å•†
- **åœ°ç†ä½ç½®ä¼˜åŒ–**: æ ¹æ®ç”¨æˆ·ä½ç½®é€‰æ‹©æœ€è¿‘çš„æ•°æ®ä¸­å¿ƒ

### ğŸ’¾ å¤šçº§ç¼“å­˜

- **L1å†…å­˜ç¼“å­˜**: <10mså“åº”
- **L2 Redisç¼“å­˜**: åˆ†å¸ƒå¼ç¼“å­˜æ”¯æŒ
- **æ™ºèƒ½ç¼“å­˜ç­–ç•¥**: åŸºäºå†…å®¹å’Œå‚æ•°çš„ç¼“å­˜é”®ç”Ÿæˆ

### ğŸ”’ ä¼ä¸šçº§å®‰å…¨

- **APIå¯†é’¥ç®¡ç†**: æ”¯æŒå¤šç§Ÿæˆ·APIå¯†é’¥
- **è¯·æ±‚é™æµ**: åŸºäºTokençš„ç²¾ç¡®é™æµæ§åˆ¶
- **å®¡è®¡æ—¥å¿—**: å®Œæ•´çš„è¯·æ±‚å“åº”å®¡è®¡

## ğŸŒ æ”¯æŒçš„AIä¾›åº”å•†

### ğŸ“Š ä¾›åº”å•†æ¦‚è§ˆ

| ä¾›åº”å•†            | Base URL                                           | æ”¯æŒæ¨¡å‹            | å®šä»·ç­‰çº§ | åŒºåŸŸ   |
| ----------------- | -------------------------------------------------- | ------------------- | -------- | ------ |
| **OpenAI**        | `https://api.openai.com/v1`                        | GPT-4, GPT-3.5      | é«˜çº§     | å…¨çƒ   |
| **Anthropic**     | `https://api.anthropic.com`                        | Claude-3ç³»åˆ—        | é«˜çº§     | ç¾è¥¿   |
| **Azure OpenAI**  | `https://{resource}.openai.azure.com`              | GPT-4, GPT-3.5      | ä¼ä¸š     | å¤šåŒºåŸŸ |
| **Google Gemini** | `https://generativelanguage.googleapis.com/v1beta` | Gemini-1.5          | æ ‡å‡†     | å¤šåŒºåŸŸ |
| **DeepSeek**      | `https://api.deepseek.com/v1`                      | DeepSeek Chat/Coder | ç»æµ     | ä¸­å›½   |
| **é€šä¹‰åƒé—®**      | `https://dashscope.aliyuncs.com/api/v1`            | Qwenç³»åˆ—            | æ ‡å‡†     | ä¸­å›½   |
| **æ–‡å¿ƒä¸€è¨€**      | `https://aip.baidubce.com/rpc/2.0/ai_custom/v1`    | ERNIE-4.0           | æ ‡å‡†     | ä¸­å›½   |
| **æ™ºè°±GLM**       | `https://open.bigmodel.cn/api/paas/v4`             | GLM-4ç³»åˆ—           | æ ‡å‡†     | ä¸­å›½   |
| **Kimi**          | `https://api.moonshot.cn/v1`                       | Moonshot-v1         | ç»æµ     | ä¸­å›½   |
| **è±†åŒ…**          | `https://ark.cn-beijing.volces.com/api/v3`         | Doubaoç³»åˆ—          | æ ‡å‡†     | ä¸­å›½   |
| **è…¾è®¯æ··å…ƒ**      | `https://api.hunyuan.cloud.tencent.com/v1`         | Hunyuanç³»åˆ—         | æ ‡å‡†     | ä¸­å›½   |
| **ç™¾åº¦åƒå¸†**      | `https://qianfan.baidubce.com/v2`                  | ERNIEç³»åˆ—           | æ ‡å‡†     | ä¸­å›½   |
| **Cohere**        | `https://api.cohere.ai/v1`                         | Commandç³»åˆ—         | æ ‡å‡†     | ç¾ä¸œ   |
| **AI21 Labs**     | `https://api.ai21.com/studio/v1`                   | Jurassic-2          | æ ‡å‡†     | ç¾ä¸œ   |
| **Stability AI**  | `https://api.stability.ai/v1`                      | Stable Diffusion    | æ ‡å‡†     | ç¾è¥¿   |
| **Midjourney**    | `https://api.midjourney.com/v1`                    | Midjourney          | é«˜çº§     | ç¾ä¸œ   |
| **Replicate**     | `https://api.replicate.com/v1`                     | å¼€æºæ¨¡å‹é›†åˆ        | æ ‡å‡†     | ç¾è¥¿   |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/zycxfyh/sira.git
cd ai-gateway

# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç¯å¢ƒå˜é‡
cp env.template .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œæ·»åŠ ä½ çš„APIå¯†é’¥
```

### 2. é…ç½®APIå¯†é’¥

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# Siraç½‘å…³é…ç½®
NODE_ENV=production
EG_HTTP_PORT=8080
EG_ADMIN_PORT=9876

# OpenAI
OPENAI_API_KEY=sk-your-openai-key

# Anthropic
ANTHROPIC_API_KEY=sk-ant-your-anthropic-key

# Azure OpenAI
AZURE_OPENAI_API_KEY=your-azure-key
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/

# å›½å†…ä¾›åº”å•†
DEEPSEEK_API_KEY=sk-your-deepseek-key
QIANFAN_API_KEY=your-qianfan-key
GLM_API_KEY=your-glm-key

# å…¶ä»–ä¾›åº”å•†...
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘ç¯å¢ƒ
npm run start:dev

# ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èä½¿ç”¨Dockerï¼‰
docker-compose -f docker/production/docker-compose-full.yml up -d
```

## ğŸ“¡ APIä½¿ç”¨æŒ‡å—

### ğŸ”„ ç»Ÿä¸€APIæ¥å£

Siraç½‘å…³æä¾›ç»Ÿä¸€çš„APIæ¥å£ï¼Œæ— éœ€å…³å¿ƒåº•å±‚ä¾›åº”å•†åˆ‡æ¢ï¼š

```bash
# èŠå¤©è¡¥å…¨ (è‡ªåŠ¨è·¯ç”±åˆ°æœ€ä¼˜ä¾›åº”å•†)
curl -X POST http://localhost:8080/api/v1/ai/chat/completions \
  -H "Content-Type: application/json" \
  -H "x-api-key: your-gateway-key" \
  -d '{
    "model": "gpt-4",
    "messages": [
      {"role": "user", "content": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±"}
    ],
    "temperature": 0.7,
    "max_tokens": 1000
  }'
```

### ğŸ¯ æŒ‡å®šä¾›åº”å•†

å¦‚æœéœ€è¦æ˜ç¡®æŒ‡å®šä¾›åº”å•†ï¼š

```bash
# å¼ºåˆ¶ä½¿ç”¨OpenAI
curl -X POST http://localhost:8080/api/v1/ai/chat/completions \
  -H "Content-Type: application/json" \
  -H "x-api-key: your-gateway-key" \
  -H "x-ai-provider: openai" \
  -d '{"model": "gpt-4", "messages": [{"role": "user", "content": "Hello"}]}'

# ä½¿ç”¨å›½å†…ä¾›åº”å•†
curl -X POST http://localhost:8080/api/v1/ai/chat/completions \
  -H "Content-Type: application/json" \
  -H "x-api-key: your-gateway-key" \
  -H "x-ai-provider: deepseek" \
  -d '{"model": "deepseek-chat", "messages": [{"role": "user", "content": "ä½ å¥½"}]}'
```

### ğŸ“‹ å¼‚æ­¥è¯·æ±‚

å¯¹äºå¤§å‹è¯·æ±‚ï¼Œæ”¯æŒå¼‚æ­¥å¤„ç†ï¼š

```bash
# å¼‚æ­¥è¯·æ±‚
curl -X POST http://localhost:8080/api/v1/ai/chat/completions \
  -H "Content-Type: application/json" \
  -H "x-api-key: your-gateway-key" \
  -d '{
    "model": "gpt-4",
    "messages": [{"role": "user", "content": "å†™ä¸€ç¯‡2000å­—çš„æ–‡ç« "}],
    "async": true,
    "webhook_url": "https://your-app.com/webhook"
  }'

# æŸ¥è¯¢è¯·æ±‚çŠ¶æ€
curl http://localhost:8080/api/v1/requests/{request-id}/status \
  -H "x-api-key: your-gateway-key"

# è·å–ç»“æœ
curl http://localhost:8080/api/v1/requests/{request-id}/result \
  -H "x-api-key: your-gateway-key"
```

## ğŸ§  è·¯ç”±ç­–ç•¥

### ğŸ¯ æˆæœ¬ä¼˜åŒ–è·¯ç”±

é»˜è®¤ç­–ç•¥ï¼šæˆæœ¬ä¼˜å…ˆï¼Œè‡ªåŠ¨é€‰æ‹©æœ€ç»æµçš„ä¾›åº”å•†

```yaml
# è·¯ç”±ä¼˜å…ˆçº§ (ä»ä¾¿å®œåˆ°è´µ)
priority_order:
  - deepseek # æœ€ä¾¿å®œ
  - kimi
  - glm
  - ernie
  - qwen
  - doubao
  - hunyuan
  - qianfan
  - google_gemini
  - cohere
  - ai21
  - anthropic # æœ€è´µ
  - openai
  - azure_openai
```

### âš¡ æ€§èƒ½ä¼˜åŒ–è·¯ç”±

```yaml
# æ€§èƒ½ä¼˜å…ˆ (å“åº”é€Ÿåº¦)
priority_order:
  - openai # æœ€å¿«
  - azure_openai
  - anthropic
  - google_gemini
  - qwen
  - ernie
  - glm
  - doubao
  - hunyuan
  - qianfan
  - cohere
  - ai21
  - deepseek
  - kimi
```

### ğŸ›¡ï¸ å¯é æ€§ä¼˜åŒ–è·¯ç”±

```yaml
# ä¼ä¸šçº§ä¾›åº”å•†ä¼˜å…ˆ
priority_order:
  - azure_openai # æœ€å¯é 
  - openai
  - anthropic
  - google_gemini
  - qwen
  - ernie
  - glm
  - doubao
  - hunyuan
  - qianfan
  - cohere
  - ai21
  - deepseek
  - kimi
```

## ğŸ“Š ä¾›åº”å•†é…ç½®è¯¦æƒ…

### OpenAIé›†æˆ

```yaml
# config/gateway.config.yml
serviceEndpoints:
  openai:
    url: 'https://api.openai.com/v1'

pipelines:
  ai-pipeline:
    policies:
      - ai-router:
          providers:
            openai:
              api_key: '${OPENAI_API_KEY}'
              models: ['gpt-4', 'gpt-3.5-turbo']
              priority: 10
```

### Azure OpenAIé›†æˆ

```yaml
serviceEndpoints:
  azure-openai:
    url: 'https://{your-resource}.openai.azure.com/openai/deployments/{deployment}'

pipelines:
  ai-pipeline:
    policies:
      - ai-router:
          providers:
            azure_openai:
              api_key: '${AZURE_OPENAI_API_KEY}'
              endpoint: '${AZURE_OPENAI_ENDPOINT}'
              deployment: 'gpt-4'
              priority: 9
```

### å›½å†…ä¾›åº”å•†é›†æˆ

```yaml
serviceEndpoints:
  deepseek:
    url: 'https://api.deepseek.com/v1'
  qwen:
    url: 'https://dashscope.aliyuncs.com/api/v1'
  ernie:
    url: 'https://aip.baidubce.com/rpc/2.0/ai_custom/v1'

pipelines:
  ai-pipeline:
    policies:
      - ai-router:
          providers:
            deepseek:
              api_key: '${DEEPSEEK_API_KEY}'
              priority: 1 # æˆæœ¬ä¼˜å…ˆ
            qwen:
              api_key: '${QIANFAN_API_KEY}'
              priority: 3
            ernie:
              api_key: '${ERNIE_API_KEY}'
              priority: 4
```

## ğŸ”§ é«˜çº§é…ç½®

### ç¼“å­˜é…ç½®

```yaml
policies:
  - ai-cache:
      ttl: 300 # ç¼“å­˜5åˆ†é’Ÿ
      maxSize: 10000 # æœ€å¤§ç¼“å­˜æ¡ç›®
      compressionEnabled: true
```

### é™æµé…ç½®

```yaml
policies:
  - ai-rate-limit:
      windowMs: 60000 # 1åˆ†é’Ÿçª—å£
      maxTokens: 100000 # æ¯åˆ†é’Ÿæœ€å¤š10ä¸‡ä¸ªtoken
      strategy: 'user' # æŒ‰ç”¨æˆ·é™æµ
```

### ç†”æ–­é…ç½®

```yaml
policies:
  - ai-circuit-breaker:
      failureThreshold: 5 # å¤±è´¥5æ¬¡åç†”æ–­
      recoveryTimeout: 60000 # ç†”æ–­60ç§’åé‡è¯•
      monitoring: true
```

### é˜Ÿåˆ—é…ç½®

```yaml
policies:
  - ai-queue:
      maxConcurrent: 10 # æœ€å¤§å¹¶å‘æ•°
      maxQueueSize: 1000 # é˜Ÿåˆ—æœ€å¤§é•¿åº¦
      timeout: 300000 # è¶…æ—¶æ—¶é—´
      priorityLevels: 3 # ä¼˜å…ˆçº§æ•°é‡
```

## ğŸ“ˆ ç›‘æ§å’ŒæŒ‡æ ‡

### å®æ—¶ç›‘æ§

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
curl http://localhost:8080/health

# æŸ¥çœ‹ç½‘å…³æŒ‡æ ‡
curl http://localhost:8080/metrics

# æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€
curl http://localhost:8080/api/v1/queue/status
```

### å¯è§‚æµ‹æ€§é¢æ¿

- **Grafana**: http://localhost:3001 (å¯è§†åŒ–ç›‘æ§é¢æ¿)
- **Prometheus**: http://localhost:9090 (æŒ‡æ ‡æ”¶é›†)
- **Jaeger**: http://localhost:16686 (åˆ†å¸ƒå¼è¿½è¸ª)

### å‘Šè­¦é…ç½®

```yaml
# Prometheuså‘Šè­¦è§„åˆ™
alerting:
  rules:
    - alert: HighErrorRate
      expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
      labels:
        severity: warning
      annotations:
        summary: 'é«˜é”™è¯¯ç‡è­¦å‘Š'

    - alert: CircuitBreakerOpen
      expr: circuit_breaker_state{state="open"} > 0
      labels:
        severity: critical
      annotations:
        summary: 'æœåŠ¡ç†”æ–­å™¨å·²å¼€å¯'
```

## ğŸ”’ å®‰å…¨é…ç½®

### APIå¯†é’¥ç®¡ç†

```yaml
credentials:
  - id: 'user-key-1'
    consumerId: 'user-1'
    type: 'key-auth'
    key: 'sk-user-key-123'

  - id: 'service-key-1'
    consumerId: 'service-1'
    type: 'key-auth'
    key: 'sk-service-key-456'
```

### è¯·æ±‚è¿‡æ»¤

```yaml
policies:
  - request-transformer:
      add:
        headers:
          x-request-id: '$(uuid)'
          x-client-ip: '$(req.ip)'

  - response-transformer:
      add:
        headers:
          x-processed-by: 'sira-gateway'
          x-response-time: '$(res.responseTime)'
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥

```yaml
# åŸºäºå†…å®¹çš„ç¼“å­˜
ai-cache:
  keyGenerator: 'content-based'
  varyByHeaders: ['authorization', 'x-api-key']
  compression: true
```

### è´Ÿè½½å‡è¡¡

```yaml
ai-router:
  loadBalancing:
    enabled: true
    strategy: 'weighted-round-robin'
    weights:
      openai: 30
      anthropic: 25
      azure_openai: 20
      deepseek: 15
      qwen: 10
```

### è¿æ¥æ± ä¼˜åŒ–

```yaml
serviceEndpoints:
  openai:
    url: 'https://api.openai.com/v1'
    timeout: 30000
    retries: 3
    connectionPool:
      maxConnections: 100
      maxIdleTime: 30000
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ä¾›åº”å•†åˆ‡æ¢å¤±è´¥

```bash
# æ£€æŸ¥è·¯ç”±é…ç½®
curl http://localhost:8080/api/v1/router/status

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker-compose logs ai-gateway | grep ERROR
```

#### 2. ç¼“å­˜å‘½ä¸­ç‡ä½

```bash
# æ£€æŸ¥ç¼“å­˜ç»Ÿè®¡
curl http://localhost:8080/api/v1/cache/stats

# è°ƒæ•´ç¼“å­˜é…ç½®
# å¢åŠ TTLæˆ–è°ƒæ•´ç¼“å­˜é”®ç”Ÿæˆç­–ç•¥
```

#### 3. è¯·æ±‚é˜Ÿåˆ—ç§¯å‹

```bash
# æ£€æŸ¥é˜Ÿåˆ—çŠ¶æ€
curl http://localhost:8080/api/v1/queue/status

# æ‰©å±•é˜Ÿåˆ—å®¹é‡æˆ–å¢åŠ å¹¶å‘æ•°
```

### æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs -f ai-gateway

# è¿‡æ»¤ç‰¹å®šè¯·æ±‚
docker-compose logs ai-gateway | grep "request-id-123"
```

## ğŸ“š æœ€ä½³å®è·µ

### 1. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# ä½¿ç”¨Docker Composeç”Ÿäº§é…ç½®
docker-compose -f docker/production/docker-compose-full.yml up -d

# é…ç½®åå‘ä»£ç†
nginx -t && nginx -s reload

# è®¾ç½®ç›‘æ§å‘Šè­¦
./scripts/monitor-system.sh
```

### 2. é«˜å¯ç”¨é…ç½®

```yaml
# å¤šå®ä¾‹éƒ¨ç½²
services:
  ai-gateway-1:
    ports: ["8080:8080"]
  ai-gateway-2:
    ports: ["8081:8080"]
  ai-gateway-3:
    ports: ["8082:8080"]

# è´Ÿè½½å‡è¡¡å™¨é…ç½®
upstream ai_gateway {
    server localhost:8080;
    server localhost:8081;
    server localhost:8082;
}
```

### 3. å¤‡ä»½å’Œæ¢å¤

```bash
# æ•°æ®å¤‡ä»½
./scripts/backup.sh

# é…ç½®æ¢å¤
./scripts/restore.sh backup-2025-11-07.tar.gz
```

## ğŸ¯ æ€»ç»“

Sira AIç½‘å…³ä¸ºAIåº”ç”¨æä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼š

- âœ… **ç»Ÿä¸€æ¥å£**: æ”¯æŒ20+ AIä¾›åº”å•†ï¼Œæ— ç¼åˆ‡æ¢
- âœ… **æ™ºèƒ½è·¯ç”±**: æˆæœ¬ã€æ€§èƒ½ã€å¯é æ€§å¤šç»´åº¦ä¼˜åŒ–
- âœ… **ä¼ä¸šçº§åŠŸèƒ½**: ç¼“å­˜ã€é™æµã€ç†”æ–­ã€é˜Ÿåˆ—ã€ç›‘æ§
- âœ… **é«˜å¯ç”¨**: åˆ†å¸ƒå¼æ¶æ„ï¼Œæ•…éšœè‡ªåŠ¨æ¢å¤
- âœ… **æ˜“äºé›†æˆ**: RESTful APIï¼Œå®Œæ•´çš„SDKæ”¯æŒ

é€šè¿‡Siraï¼Œæ‚¨å¯ä»¥ï¼š

1. **é™ä½æˆæœ¬**: æ™ºèƒ½è·¯ç”±é€‰æ‹©æœ€ç»æµçš„ä¾›åº”å•†
2. **æå‡æ€§èƒ½**: å¤šçº§ç¼“å­˜å’Œè´Ÿè½½å‡è¡¡
3. **ä¿éšœç¨³å®šæ€§**: ç†”æ–­å’Œé‡è¯•æœºåˆ¶
4. **ç®€åŒ–è¿ç»´**: å®Œæ•´çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»
5. **å¿«é€Ÿæ‰©å±•**: æ”¯æŒæ–°ä¾›åº”å•†çš„çƒ­æ’æ‹”

å¼€å§‹ä½¿ç”¨Siraï¼Œè®©AIé›†æˆå˜å¾—ç®€å•è€Œå¼ºå¤§ï¼ğŸš€
